
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>史成</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="史成">
    

    
    <meta name="description" content="天道酬勤">
<meta property="og:type" content="website">
<meta property="og:title" content="史成">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="史成">
<meta property="og:description" content="天道酬勤">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="史成">
<meta name="twitter:description" content="天道酬勤">

    
    <link rel="alternative" href="www.baidu.com" title="史成" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/shicheng.png">
    
    
    <link rel="apple-touch-icon" href="/img/shicheng.png">
    <link rel="apple-touch-icon-precomposed" href="/img/shicheng.png">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/shicheng.png" alt="史成" title="史成"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="史成">史成</a></h1>
				<h2 class="blog-motto">知其然，知其所以然。一天一篇博客，一个星期研究一个第三方Demo，三个月看一本书！ 2017.7.1</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/21/swift模块化/" title="swift项目 模块化发展方向" itemprop="url">swift项目 模块化发展方向</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="史成" target="_blank" itemprop="author">史成</a>
		
  <p class="article-time">
    <time datetime="2017-07-20T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-07-21</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>###开篇<br>写了这么多年的代码，目前觉得最好的构造项目结构的方式就是 模块化。</p>
<p>模块化在 Objective-C 的项目中可能比较难搞起来，但是在 Swift 项目中就游润有余了，因为 Swift 有着天生 Module 的概念，和它的访问控制修饰符。</p>
<p>小型项目搞模块化意义可能不大，对于中型和大型的项目，模块化以后，纵向分层横向分模块，模块间解耦，访问控制，依赖注入，依赖倒转，在开发过程中就能自然而然的写出来，省去以后重构的苦恼。</p>
<p>大家都知道，Xcode 主要是用 Workspace 和 Project 来组织项目结构的，一个工程只能有一个 Workspace，一个 Workspace 中可以有任意多个 Project。</p>
<p>而模块化的方式就是把各个业务功能拆分成模块（Framework），然后主工程负责把这些业务模块串联起来构成一个完成的 App。</p>
<p>###工程结构<br>在一个项目里，有一个 Workspace，其中有很多个 Project，主工程是一个 Project，每个业务模块也都是一个 Project。</p>
<p>如下图一样：</p>
<p><img src="http://ooyerqo96.bkt.clouddn.com/17-7-27/6739231.jpg" alt=""><br><img src="http://ooyerqo96.bkt.clouddn.com/17-7-27/58826050.jpg" alt=""></p>
<p>在工程中，每添加一个新模块的时候，通过点击左下角的 + 来创建，选择 Framework 类型：</p>
<p><img src="http://ooyerqo96.bkt.clouddn.com/17-7-27/96013257.jpg" alt=""></p>
<p>路径选择到 Modules 目录下。</p>
<p>如果你觉得需要的话，可以对 Modules 目录下的这些 Project 再分目录。</p>
<p>如何创建 Workspace？<br>如果是从一个新工程开始创建，可以在 Xcode 中选择：File -&gt; New -&gt; Workspace… 创建，然后再在创建好的 Workspace 中添加主工程。</p>
<p>如果你是用了 CocoaPods，在第一次 pod install 时，CocoaPods 会帮你创建好 Workspace。</p>
<p>###依赖配置<br>对于每一个模块 xcodeproj，都需要在这里严格配置好它的依赖。</p>
<p><img src="http://ooyerqo96.bkt.clouddn.com/17-7-27/10499864.jpg" alt=""></p>
<p>同属于一个 Workspace 的 Project 们，可以方便的互相配置依赖，Xcode 可以很好的处理好这个依赖。</p>
<p>配置了依赖以后的 Framework，在编译时 Xcode 会先编译它依赖的那些 Framework, 确保这个 Framework 可以顺利配置成功。</p>
<p>用这种项目结构时，依赖必须严格配置正确，否则即使在模拟器或真机运行时没有问题，打包的时候一定会出现问题。这样当想知道一个模块依赖了哪些模块时，可以直观的从这里查看到。<br>为每一个模块添加 Demo 和单元测试<br>由于一个模块是一个单独的 Project，可以在里面方便的添加 Demo 和单元测试的 Target。</p>
<p>###CocoaPods<br>如果你的某一个模块需要依赖 CocoaPods 中的库，CocoaPods 本身也很好的支持了这个需求。</p>
<p>在 Podfile 文件中添加一个 target 的配置即可。</p>
<p>###Carthage<br>使用 Swift 语言的项目也会经常用到 Carthage。一般都是直接依赖 Carthage/Build 中编译好的 .framework 文件，然后类型为 App 的 Project，要配置 copy-framework 脚本，类型为 Framework 的 Project，要在 Build Phases 中添加一个 Copy Files Phases，这是官方文档中的说法。</p>
<p>但是在我们这种项目结构中，如果为每个模块都配置 Copy Files Phases，会导致打出来的包中，每个模块的 Framework 都包含了它依赖的那些 Framework，导致包大小非常大，因为里面包含了非常多的重复 Framework。</p>
<p>于是我们再 Workspace 中又建立的一个目录叫 CarthageFrameworks，然后把 Carthage/Checkout 目录中的那些 .xcodeproj 文件拖到这个 CarthageFrameworks 目录中</p>
<p>列举一下好处<br>模块化，各模块之间独立，职责清晰<br>开发过程中会自然强制你考虑模块间解耦，访问控制，依赖注入，依赖倒转等问题<br>依赖必须严格配置，方便查看和梳理依赖<br>每个 Project 都有一个 xxx.xcodeproj文件，这个文件是最常出现冲突的文件了，而且这个文件的冲突还往往很难解决，模块化分开后，各个模块都有单独的 xxx.xcodeproj 文件，大大降低发生冲突的概率。<br>模块拥有自己的 Targets 空间，方便创建 Demo 和单元测试<br>如果想把模块做成单独的 git 仓库，也非常的方便<br>方便进行 Carthage 引入的库的调试</p>
<p>原文网址 <a href="https://liuduo.me/2017/05/22/moduleproject/" target="_blank" rel="external">https://liuduo.me/2017/05/22/moduleproject/</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/20/a和framework区别/" title="静态库、动态库概念" itemprop="url">静态库、动态库概念</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="史成" target="_blank" itemprop="author">史成</a>
		
  <p class="article-time">
    <time datetime="2017-07-19T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-07-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>###一、什么是库？</p>
<p>库是共享程序代码的方式，一般分为静态库和动态库。</p>
<p>###二、静态库与动态库的区别？</p>
<p>静态库：链接时完整地拷贝至可执行文件中，被多次使用就有多份冗余拷贝。</p>
<p>动态库：链接时不复制，程序运行时由系统动态加载到内存，供程序调用，系统只加载一次，多个程序共用，节省内存。</p>
<p>###三、iOS里静态库形式？</p>
<p>.a和.framework</p>
<p>###四、iOS里动态库形式？</p>
<p>.dylib和.framework</p>
<p>###五、framework为什么既是静态库又是动态库？</p>
<p>系统的.framework是动态库，我们自己建立的.framework是静态库。</p>
<p>###六、a与.framework有什么区别？</p>
<p>.a是一个纯二进制文件，.framework中除了有二进制文件之外还有资源文件。</p>
<p>.a文件不能直接使用，至少要有.h文件配合，.framework文件可以直接使用。</p>
<p>.a + .h + sourceFile = .framework。</p>
<p>建议用.framework.</p>
<p>###七、为什么要使用静态库？</p>
<p>方便共享代码，便于合理使用。</p>
<p>实现iOS程序的模块化。可以把固定的业务模块化成静态库。</p>
<p>和别人分享你的代码库，但不想让别人看到你代码的实现。</p>
<p>开发第三方sdk的需要。</p>
<p>###八、制作静态库时的几点注意：</p>
<p>1 注意理解：无论是.a静态库还.framework静态库，我们需要的都是二进制文件+.h+其它资源文件的形式，不同的是，.a本身就是二进制文件，需要我们自己配上.h和其它文件才能使用，而.framework本身已经包含了.h和其它文件，可以直接使用。</p>
<p>2 图片资源的处理：两种静态库，一般都是把图片文件单独的放在一个.bundle文件中，一般.bundle的名字和.a或.framework的名字相同。.bundle文件很好弄，新建一个文件夹，把它改名为.bundle就可以了，右键，显示包内容可以向其中添加图片资源。</p>
<p>3 category是我们实际开发项目中经常用到的，把category打成静态库是没有问题的，但是在用这个静态库的工程中，调用category中的方法时会有找不到该方法的运行时错误（selector not recognized），解决办法是：在使用静态库的工程中配置other linker flags的值为-ObjC。</p>
<p>4 如果一个静态库很复杂，需要暴露的.h比较多的话，就可以在静态库的内部创建一个.h文件（一般这个.h文件的名字和静态库的名字相同），然后把所有需要暴露出来的.h文件都集中放在这个.h文件中，而那些原本需要暴露的.h都不需要再暴露了，只需要把.h暴露出来就可以了。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/19/swift中的自定义打印/" title="swift中自定义DBug模式" itemprop="url">swift中自定义DBug模式</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="史成" target="_blank" itemprop="author">史成</a>
		
  <p class="article-time">
    <time datetime="2017-07-18T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-07-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="swift中自定义DBug模式"><a href="#swift中自定义DBug模式" class="headerlink" title="swift中自定义DBug模式"></a>swift中自定义DBug模式</h3><p>在日常开发中经常需要调试,这时候往往需要利用宏自定义打印,那么在项目完成需要上线的时候就不用手动一个一个地删除打印的代码。<br>与OC不同的是，swift没有所谓的pch文件，即时新建了也产生不了什么作用，而且swift3.0也没有预编译命令#define，只能通过最新的语法来实现自定义log。</p>
<p>其实Xcode中是允许自定义宏定义,这种方式在即使Swift中也是可行的。具体操作如下:</p>
<p><img src="http://ooyerqo96.bkt.clouddn.com/1304069-61b4ee96b75e6bf3.png" alt=""></p>
<p><img src="http://ooyerqo96.bkt.clouddn.com/1304069-7e41e6622c1cd3ae.png" alt=""></p>
<p>这样就相当于在DEBUG模式下有一个DEBUG的宏定义了!<br>接下来想定义一个只有在DEBUG模式下才有效的打印就简单了,只需要一个简单的函数就可以实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">func customLog&lt;T&gt;(message : T)&#123;</div><div class="line">#if DEBUG</div><div class="line">        print(message)</div><div class="line">#endif</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p> 当然,还可以添加自己拓展一下功能,比如让其打印出在哪个方法哪行代码中调用了这个函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">func customLog&lt;T&gt;(message : T,methodName: String = __FUNCTION__, lineNumber: Int = __LINE__)&#123;</div><div class="line">#if DEBUG</div><div class="line">        print(&quot;\(methodName)[\(lineNumber)]:\(message)&quot;)</div><div class="line">#endif</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">//自定义调试阶段log</div><div class="line">    func delog(filePath: String = #file, rowCount: Int = #line) &#123;</div><div class="line">        #if DEBUG</div><div class="line">            let fileName = (filePath as NSString).lastPathComponent.replacingOccurrences(of: &quot;.swift&quot;, with: &quot;&quot;)</div><div class="line">            print(fileName + &quot;/&quot; + &quot;\(rowCount)&quot; + &quot;\n&quot;)</div><div class="line">        #endif</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    func delog&lt;T&gt;(_ message: T, filePath: String = #file, rowCount: Int = #line) &#123;</div><div class="line">        #if DEBUG</div><div class="line">        let fileName = (filePath as NSString).lastPathComponent.replacingOccurrences(of: &quot;.swift&quot;, with: &quot;&quot;)   </div><div class="line">            print(fileName + &quot;/&quot; + &quot;\(rowCount)&quot; + &quot; \(message)&quot; + &quot;\n&quot;)</div><div class="line">        #endif</div><div class="line">    &#125;</div><div class="line">一个是可以不带打印信息参数的，一个是需要带打印信息参数的。该函数的实现使用了swift泛型的概念，因为我们知道需要打印的信息是任意类型的变量，而不仅仅是字符串。</div><div class="line"></div><div class="line">在本例中，我只使用了#file、#line这两个额外信息，因为对于#function来说，#line已经完全能够定位到代码的执行地点，#function未免过于冗长和多余，当然，这个只是个人偏好的问题，可以带上也不可以选择不带上。在上例的函数中，我使用了自己配置的debug阶段的标识符DEBUG，能够在函数执行后，在debug阶段打印想要的信息，在Release阶段则什么都不做。另外，此处我对#file这个String变量做了额外的处理，在swift中，#file是会返回一个文件所在的绝对路径，这个路径过于冗长，我们只需要其最后一个路径即可，也就是先将其转换为OC类型NSString，再截取最后一个路径，之后，我删除了最后文件名中的所有“.swift”后缀，最终在大多数情况下我就只得到该文件名的类名。</div></pre></td></tr></table></figure>
<p>想直接把Unicode代码转变成汉字吗，试试下边的方法吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">extension String &#123;</div><div class="line">    var unicodeStr:String &#123;</div><div class="line">        let tempStr1 = self.stringByReplacingOccurrencesOfString(&quot;\\u&quot;, withString: &quot;\\U&quot;)</div><div class="line">        let tempStr2 = tempStr1.stringByReplacingOccurrencesOfString(&quot;\&quot;&quot;, withString: &quot;\\\&quot;&quot;)</div><div class="line">        let tempStr3 = &quot;\&quot;&quot;.stringByAppendingString(tempStr2).stringByAppendingString(&quot;\&quot;&quot;)</div><div class="line">        let tempData = tempStr3.dataUsingEncoding(NSUTF8StringEncoding)</div><div class="line">        var returnStr:String = &quot;&quot;</div><div class="line">        do &#123;</div><div class="line">            returnStr = try NSPropertyListSerialization.propertyListWithData(tempData!, options: .Immutable, format: nil) as! String</div><div class="line">        &#125; catch &#123;</div><div class="line">            print(error)</div><div class="line">        &#125;</div><div class="line">        return returnStr.stringByReplacingOccurrencesOfString(&quot;\\r\\n&quot;, withString: &quot;\n&quot;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="http://www.jianshu.com/p/6fcee2da93be" target="_blank" rel="external">原文网址</a><a href="http://www.jianshu.com/p/6fcee2da93be" target="_blank" rel="external">http://www.jianshu.com/p/6fcee2da93be</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/18/适配问题/" title="屏幕适配反思整理" itemprop="url">屏幕适配反思整理</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="史成" target="_blank" itemprop="author">史成</a>
		
  <p class="article-time">
    <time datetime="2017-07-17T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-07-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>###屏幕适配</p>
<p>老生常谈，总会存在适配问题，不管设计稿合理不合理，原理就那么点东西。</p>
<p>设备信息如图：<br><img src="http://ooyerqo96.bkt.clouddn.com/Screen%20Shot%202017-07-25%20at%2018.00.46.png" alt="jietu"></p>
<p>现在APP设计开发必须考虑适配大、中、小三种屏幕。所以如何做到交付一套设计稿解决适配大中小三屏的问题？设计和开发之间采用什么协作模式？一个基本思路是：1、选择一种尺寸作为设计和开发基准；2、定义一套适配规则，自动适配剩下两种尺寸；3、特殊适配效果给出设计效果。</p>
<p>手机淘宝的团队写作模式<br><img src="http://ooyerqo96.bkt.clouddn.com/62dd57dee9f859151b8ea6a939968a53_b.jpg" alt="taobao"></p>
<p>第一步，视觉设计阶段，设计师按宽度750px（iPhone 6）做设计稿，除图片外所有设计元素用矢量路径来做。设计定稿后在750px的设计稿上做标注，输出标注图。同时等比放大1.5倍生成宽度1125px的设计稿，在1125px的稿子里切图。第二步，输出两个交付物给开发工程师：一个是程序用到的@3x切图资源，另一个是宽度750px的设计标注图。第三步，开发工程师拿到750px标注图和@3x切图资源，完成iPhone 6（375pt）的界面开发。此阶段不能用固定宽度的方式开发界面，得用自动布局（auto layout），方便后续适配到其它尺寸。第四步，适配调试阶段，基于iPhone 6的界面效果，分别向上向下调试iPhone 6 plus（414pt）和iPhone 5S及以下（320pt）的界面效果。由此完成大中小三屏适配。</p>
<p>为什么选择iPhone 6作为基准尺寸？<br>当面对大中小三种屏幕需要适配的时候，很容易想到先做好一种屏幕，再去适配剩下两种屏幕。第一个决定是到底以哪种屏幕作为设计和开发的基准尺寸。我们选择中间尺寸的iPhone 6（750px/375pt）作为基准，基于几个原因：<br>1、从中间尺寸向上和向下适配的时候界面调整的幅度最小。375pt下的设计效果适配到414pt和320pt偏差不会太大。假设以414pt为基准做出很优雅的设计，到320pt可能元素之间比例就不是那么回事了，比如图片和文字之间视觉比例可能失调。2、iPhone 6 plus有两种显示模式，标准模式分辨率为1242x2208，放大模式分辨率为1125x2001（即iPhone 6的1.5倍）。可见官方系统里iPhone 6和iPhone 6 plus分辨率之间就存在1.5倍的倍率关系。很多情况下这两种尺寸可以用1.5倍直接等比适配。<br>3、1242x2208这个奇葩的数值是苹果官方都不愿意公开宣传的一个分辨率，不便于记忆和计算栅格。640x1136虽然是广泛应用的一个分辨率，但是大屏时代依然以小尺寸为设计基准显然不合时宜，设计师会停留在小屏的视角做设计。<br>所以，iPhone6的750x1334是最适合基准尺寸。</p>
<p><strong>前文提到适配策略是先选择iPhone 6作为基准设计尺寸，然后通过一套适配规则自动适配到另外两种尺寸。这套适配规则总结起来就一句话：文字流式，控件弹性，图片等比缩放</strong></p>
<p><img src="http://ooyerqo96.bkt.clouddn.com/feffdcc6023e2f17e9000d2e70a34d91_b.jpg" alt="shipeiyuanze"></p>
<p>控件弹性指的是，navigation、cell、bar等适配过程中垂直方向上高度不变；水平方向宽度变化时，通过调整元素间距或元素右对齐的方式实现自适应。这样屏幕越大，在垂直方向上可以显示更多内容，发挥大屏幕的优势。</p>
<p>按照上述默认适配规则，大中小三种屏幕显示效果均相同。有时候想在大屏幕显示更多内容，需要设计出特殊适配效果。比如App store首页焦点图，从iPhone 6适配到iPhone 6 plus时焦点图尺寸和排版做了特殊处理。底下应用列表也从一排3+个变成一排4+个，真正实现了大屏幕显示更多内容的理念。这些就需要设计师给出相应设计稿。</p>
<p>有两种适配方式：一种是控件的所有参数等比放大，效果是屏幕上的内容在不同大小设备上完全相同；另一种是控件的大小不变，控件的左右间距随屏幕变化，效果是屏幕越大，显示内容越多。</p>
<p><img src="http://ooyerqo96.bkt.clouddn.com/Screen%20Shot%202017-07-25%20at%2018.13.30.png" alt=""></p>
<p><img src="http://ooyerqo96.bkt.clouddn.com/Screen%20Shot%202017-07-25%20at%2018.13.44.png" alt=""></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/17/swift自定义xib添加到Storyboard上/" title="swift自定义xib添加到storyboard注意事项" itemprop="url">swift自定义xib添加到storyboard注意事项</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="史成" target="_blank" itemprop="author">史成</a>
		
  <p class="article-time">
    <time datetime="2017-07-16T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-07-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>其实swift中很OC中原理是一样的。</p>
<p>一、准备工作<br>新建Xcode工程<br>新建一个UIView：MyView.swift 集成自UIView<br>新建一个UIView的xib布局文件：MyView.xib </p>
<p>二、互相关联MyView.xib与MyView.swift<br>设置MyView.xib的File’s Owner 的Custom Class为MyView<br>注意：不要修改MyView.xib下View的Custom Class，保存其为默认的UIView。 </p>
<p>MyView.swift设置<br>将MyView.xib下的View拖拽到MyView.swift中关联IBOutlet属性变量：view<br>    @IBOutlet var view: UIView!<br>添加初始化代码在MyView.swift中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">override init(frame: CGRect) &#123;</div><div class="line">    super.init(frame: frame)</div><div class="line">    initViewFromNib()</div><div class="line">&#125;</div><div class="line"></div><div class="line">required init?(coder aDecoder: NSCoder) &#123;</div><div class="line">    super.init(coder: aDecoder)</div><div class="line">    initViewFromNib()</div><div class="line">&#125;</div><div class="line"></div><div class="line">private func initViewFromNib()&#123;</div><div class="line">    // 需要这句代码，不能直接写UINib(nibName: &quot;MyView&quot;, bundle: nil)，不然不能在storyboard中显示</div><div class="line">    let bundle = Bundle(for: type(of: self))</div><div class="line">    let nib = UINib(nibName: &quot;MyView&quot;, bundle: bundle)</div><div class="line">    self.view = nib.instantiate(withOwner: self, options: nil)[0] as! UIView</div><div class="line">    self.view.frame = bounds</div><div class="line">    self.addSubview(view)</div><div class="line"></div><div class="line">    // Do any additional setup after loading the view.</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>三、添加MyView.xib到Main.storyboard
</code></pre><p>拖拽一个UIView到Main.storyboard中，设置该UIView的Custom Class为MyView, 添加一下布局约束.</p>
<p>四、让Xcode下Main.storyboard中预览xib</p>
<p>细心的朋友注意到了，Main.storyboard中没有刷新xib视图，只能运行后才能看到，下面我们让Main.storyboard中也能预览xib。 </p>
<ol>
<li>添加@IBDesignable属性 </li>
<li>添加Main.storyboard下xib初始化方法 </li>
<li>注意： </li>
</ol>
<ul>
<li>Xcode非运行状态下storyboard加载xib使用NSBundle.mainBundle().loadNibNamed会出现找不到xib文件的错误。 </li>
<li>xib加载后，需要设置其frame大小，不然frame会是xib中的大小。 </li>
<li>每次选中storyboard，都会自动Build一次来刷新其中xib视图，如果过程中出现错误信息可以直接Xcode下查看，如果出现Crash错误，Xcode下不会显示，此时去查看下面的crash文件来帮助你定位问题。 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line"></div><div class="line">@IBDesignable class MyView: UIView &#123;</div><div class="line"></div><div class="line">    @IBOutlet var view: UIView!</div><div class="line"></div><div class="line">    override init(frame: CGRect) &#123;</div><div class="line">        super.init(frame: frame)</div><div class="line">        initViewFromNib()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    required init?(coder aDecoder: NSCoder) &#123;</div><div class="line">        super.init(coder: aDecoder)</div><div class="line">        initViewFromNib()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private func initViewFromNib()&#123;</div><div class="line">        // 需要这句代码，不能直接写UINib(nibName: &quot;MyView&quot;, bundle: nil)，不然不能在storyboard中显示</div><div class="line">        let bundle = Bundle(for: type(of: self))</div><div class="line">        let nib = UINib(nibName: &quot;MyView&quot;, bundle: bundle)</div><div class="line">        self.view = nib.instantiate(withOwner: self, options: nil)[0] as! UIView</div><div class="line">        self.view.frame = bounds</div><div class="line">        self.addSubview(view)</div><div class="line"></div><div class="line">        // Do any additional setup after loading the view.</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @IBAction func tapped(sender: AnyObject) &#123;</div><div class="line">        print(&quot;tappd&quot;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>知识点在第四部，storyboard中展示预览自定义好的xib。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/16/UIWebView缓存问题/" title="UIWebVIew 缓存" itemprop="url">UIWebVIew 缓存</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="史成" target="_blank" itemprop="author">史成</a>
		
  <p class="article-time">
    <time datetime="2017-07-15T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-07-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>###UIWebView 缓存</p>
<p>前言</p>
<p>在开发项目过程中, 难免会使用 HTML 来展示一些页面.<br>在 iOS 中, 使用 UIWebView 的频率还是比较高的.<br>准备工作</p>
<p>我今天使用 Tomcat 来作为 web 容器, 在本机搭建一个 web 服务器, 然后使用 iPhone 访问该 web 页面, 展示和梳理 UIWebview 关于缓存的问题.</p>
<p>如果你对 Tomcat 还不熟悉, 希望你可以先去大概了解一下, 如何在 Mac os 上面安装和使用 Tomcat, 可以参考我的博文: Mac 配置 Tomcat8.</p>
<p>Tomcat 是一个开放源代码、运行 servlet 和 JSP Web 应用软件的基于 Java 的 Web 应用软件容器.<br>Tomcat Server 是根据 servlet 和 JSP 规范执行的，因此可以说 Tomcat Server 实行了 Apache-Jakarta 规范，且比绝大多数商业应用软件服务器要好.<br>但是 Tomcat 对静态文件、高并发的处理比较弱.</p>
<p>写这篇文章的时候, 我使用的版本分别是 apache-tomcat-8.5.8, jdk1.8.<br>配置 Tomcat<br>修改 server.xml 文件<br>文件在 Tomcat 的根目录的 conf 目录下, 如我的文件在这个目录:<br>apache-tomcat-8.5.8/conf/server.xml<br>增加如下内容:</p>
<p><host name="<your local ip>" debug="0" appbase="<base dir>" unpackwars="true" autodeploy="true" xmlvalidation="false" xmlnamespaceaware="false"><br>    <context path="" docbase="<html file path>" debug="0" reloadable="true" crosscontext="true"><br>    <logger classname="org.apache.catalina.logger.FileLogger" directory="logs" prefix="tot_log." suffix=".txt" timestamp="true"><br></logger></context></host><br>注意:<br>1.将上述内容放到  和  节点中间.<br>2.将 name=”<your local="" ip="">“ 中的 <your local="" ip=""> 改为你本机的 ip 地址.<br>查看本机的 ip 地址方法很简单:</your></your></p>
<p>ifconfig | grep “inet “ | grep -v 127.0.0.1<br>3.将 appBase=”<base dir="">“ 中的 <base dir=""> 改为你的 web 目录.<br>4.将 docBase=”<html file="" path="">“ 中的 <html file="" path=""> 改为你的 html 目录.</html></html></p>
<p>我的配置如下(部分):</p>
<pre><code>&lt;Host name=&quot;localhost&quot;  appBase=&quot;webapps&quot;
        unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt;
    &lt;!-- SingleSignOn valve, share authentication between web applications
         Documentation at: /docs/config/valve.html --&gt;
    &lt;!--
    &lt;Valve className=&quot;org.apache.catalina.authenticator.SingleSignOn&quot; /&gt;
    --&gt;
    &lt;!-- Access log processes all example.
         Documentation at: /docs/config/valve.html
         Note: The pattern used is equivalent to using pattern=&quot;common&quot; --&gt;
    &lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot;
           prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot;
           pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot; /&gt;
&lt;/Host&gt;
    &lt;!--mark 配置静态网页. [BEGIN] --&gt;
    &lt;Host name=&quot;192.168.1.103&quot; debug=&quot;0&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot; xmlValidation=&quot;false&quot;  xmlNamespaceAware=&quot;false&quot;&gt;
        &lt;Context path=&quot;&quot; docBase=&quot;test&quot; debug=&quot;0&quot; reloadable=&quot;true&quot; crossContext=&quot;true&quot;/&gt;
        &lt;Logger className=&quot;org.apache.catalina.logger.FileLogger&quot; directory=&quot;logs&quot; prefix=&quot;tot_log.&quot; suffix=&quot;.txt&quot; timestamp=&quot;true&quot;/&gt;
    &lt;/Host&gt;
    &lt;!--mark 配置静态网页. [END] --&gt;
&lt;/Engine&gt;
</code></pre><p>  <br><br>搞定上面的配置, 接下来可以配置相关目录了.</p>
<p>在 Tomcat 的根目录有个文件夹 webapps, 在 webapps 目录下新建目录 test 即可.<br>构建 HTML 页面<br>在 test 目录, 新建一个 html 文件<br>touch test.html<br>文件内容如下:<br> </p><p><br><em>Sample</em> text</p><p></p>
<p></p><p><br>Now I input another line, with fancy<u><strong><em>styles</em></strong><br></u>.</p><p></p>
<p></p><p><br><em>Sample</em> text</p><p></p>
<p></p><p><br>Now I input another line, with fancy <u><strong><em>styles</em></strong><br></u>.</p><p></p>
<p></p><p><br>    mark.zhang is itman.<br></p><p></p>
<p><style><br>.button {<br>    background-color: #4CAF50;<br>    border: none;<br>    color: white;<br>    padding: 15px 32px;<br>    text-align: center;<br>    text-decoration: none;<br>    display: inline-block;<br>    font-size: 86px;<br>    margin: 50px 200px 100px 300px;<br>    cursor: pointer;<br>    border-radius: 15;<br>}<br></style></p>
<p></p><p><br>   <button type="button" onclick="myFunction()" class="button">Try it</button><br></p><p></p>
<p><script><br>   function myFunction() {<br>       alert(“Blog: www.veryitman.com”);<br>   };<br></script><br>搭建完成后, 启动 Tomcat 服务器.</p>
<p>startup.sh<br>在浏览器里面通过 ip:port/test.html 的方式来访问该页面.<br>看到类似下面的效果即表示搭建成功:</p>
<p>1</p>
<p>客户端访问</p>
<p>客户端访问该页面, 使用 UIWebview 来请求(HTTP 协议)页面内容.</p>
<p>一般请求会使用下面的方法:</p>
<ul>
<li>(instancetype)requestWithURL:(NSURL *)URL;<br>该方法的描述如下:</li>
</ul>
<p>Creates and returns a URL request for a specified URL with default cache policy and timeout value.<br>The default cache policy is NSURLRequestUseProtocolCachePolicy and the default timeout interval is 60 seconds.<br>大概意思是使用的缓存策略是根据协议来的, 即 NSURLRequestUseProtocolCachePolicy. 超时时间默认是60s.</p>
<p>也就是说类似如下的请求:</p>
<p>NSURLRequest *urlReq = [NSURLRequest requestWithURL:url<br>                                            cachePolicy:NSURLRequestUseProtocolCachePolicy<br>                                            timeoutInterval:60.f];<br>如果协议支持缓存的话, UIWebview 请求到的数据就是缓存数据.该缓存是需要 WEB 服务器支持的.</p>
<p>这里我没有配置 Tomcat 的缓存.可以抓包看下:</p>
<p>2</p>
<p>后续博客会分别为大家介绍在 Tomcat 和 Nginx 配置缓存下, 客户端 UIWebview 请求的相关问题.</p>
<p>客户端显示页面效果:<br>3</p>
<p>ViewController 代码:</p>
<p>#import “ViewController.h”<br>static NSString <em> const H5Url = @”<a href="http://192.168.1.104:8080/test.html" target="_blank" rel="external">http://192.168.1.104:8080/test.html</a>“;<br>@interface ViewController () <uiwebviewdelegate><br>@property (nonatomic, strong) UIWebView </uiwebviewdelegate></em>webView;<br>@property (nonatomic, strong) UIButton *refBtn;<br>@end<br>@implementation ViewController</p>
<ul>
<li><p>(void)viewDidLoad<br>{<br>  [super viewDidLoad];</p>
<p>  _webView = [[UIWebView alloc] init];<br>  CGSize boundsSize = self.view.bounds.size;<br>  self.webView.frame = CGRectMake(0, 20, boundsSize.width, boundsSize.height);<br>  self.webView.backgroundColor = [UIColor whiteColor];<br>  self.webView.scrollView.showsHorizontalScrollIndicator = NO;<br>  self.webView.scrollView.showsVerticalScrollIndicator   = NO;<br>  self.webView.scalesPageToFit = YES;<br>  self.webView.delegate = self;<br>  [self.view addSubview:self.webView];</p>
<p>  UIButton *refreshBtn = [UIButton buttonWithType:UIButtonTypeCustom];<br>  [self.view addSubview:refreshBtn];<br>  [refreshBtn addTarget:self action:@selector(onRefreshWebView) forControlEvents:UIControlEventTouchUpInside];<br>  refreshBtn.backgroundColor = [UIColor redColor];<br>  refreshBtn.layer.masksToBounds = YES;<br>  refreshBtn.layer.cornerRadius = 5.f;<br>  refreshBtn.frame = CGRectMake(50, 250, 200, 50);<br>  [refreshBtn setTitle:@”刷新页面” forState:UIControlStateNormal];<br>  _refBtn = refreshBtn;</p>
<p>  [self loadDataUsingCache];<br>}</p>
</li>
<li><p>(void)webView:(UIWebView <em>)webView didFailLoadWithError:(NSError </em>)error<br>{<br>  NSLog(@”didFailLoadWithError: %@”, error);</p>
<p>  [self hideLoading];<br>}</p>
</li>
<li>(BOOL)webView:(UIWebView <em>)webView shouldStartLoadWithRequest:(NSURLRequest </em>)request<br>navigationType:(UIWebViewNavigationType)navigationType<br>{<br>  NSLog(@”shouldStartLoadWithRequest: %@”, request);<br>  return YES;<br>}</li>
<li>(void)webViewDidStartLoad:(UIWebView *)webView<br>{<br>  NSLog(@”webViewDidStartLoad”);<br>}</li>
<li><p>(void)webViewDidFinishLoad:(UIWebView *)webView<br>{<br>  NSLog(@”webViewDidFinishLoad”);</p>
<p>  [self hideLoading];<br>}<br>/**</p>
<ul>
<li>刷新页面.<br>*/</li>
</ul>
</li>
<li><p>(void)onRefreshWebView<br>{<br>  // 方式1: 不使用缓存请求数据<br>  //[self loadDataNoUsingCache];</p>
<p>  // 方式2: 清除 NSCache 缓存, 再请求数据<br>  [self clearAllCache];<br>  [self loadDataUsingCache];<br>}</p>
</li>
<li><p>(void)loadDataUsingCache<br>{<br>  [self showLoading];</p>
<p>  NSURL *url = [NSURL URLWithString:H5Url];</p>
<p>  NSURLRequest *urlReq = [NSURLRequest requestWithURL:url</p>
<pre><code>    cachePolicy:NSURLRequestReturnCacheDataDontLoad
timeoutInterval:10.f];
</code></pre><p>  [self.webView loadRequest:urlReq];<br>}</p>
</li>
<li><p>(void)loadDataWithProtocol<br>{<br>  [self showLoading];</p>
<p>  NSURL *url = [NSURL URLWithString:H5Url];</p>
<p>  [NSURLRequest requestWithURL:url];</p>
<p>  NSURLRequest *urlReq = [NSURLRequest requestWithURL:url</p>
<pre><code>    cachePolicy:NSURLRequestUseProtocolCachePolicy
timeoutInterval:60.f];
</code></pre><p>  [self.webView loadRequest:urlReq];<br>}</p>
</li>
<li><p>(void)loadDataNoUsingCache<br>{<br>  [self showLoading];</p>
<p>  NSURL <em>url = [NSURL URLWithString:H5Url];<br>  NSURLRequest </em>urlReq = [NSURLRequest requestWithURL:url</p>
<pre><code>    cachePolicy:NSURLRequestReloadIgnoringCacheData
timeoutInterval:20.0];
</code></pre><p>  [self.webView loadRequest:urlReq];<br>}</p>
</li>
<li><p>(void)clearAllCache<br>{<br>  // remove cache rsp<br>  [[NSURLCache sharedURLCache] removeAllCachedResponses];</p>
<p>  [[NSURLCache sharedURLCache] setDiskCapacity:0];<br>  [[NSURLCache sharedURLCache] setMemoryCapacity:0];<br>}</p>
</li>
<li>(void)showLoading<br>{<br>  [self.refBtn setTitle:@”刷新中…” forState:UIControlStateNormal];<br>}</li>
<li>(void)hideLoading<br>{<br>  dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{<pre><code>[self.refBtn setTitle:@&quot;刷新页面&quot; forState:UIControlStateNormal];
</code></pre>  });<br>}<br>@end<br>这里注意下面的 三个方法 :</li>
</ul>
<p>// 使用缓存数据, 如果有缓存的话<br>// 使用这个方法, 改变 HTML 或者 JS 代码<br>// 页面不会拉取最新数据, 还是使用之前请求到的数据.<br>// 除非重新刷新</p>
<ul>
<li>(void)loadDataUsingCache;<br>// 使用协议缓存, 需要 web 服务器支持.</li>
<li>(void)loadDataWithProtocol;<br>// 不使用缓存, 加载数据</li>
<li>(void)loadDataNoUsingCache;<br>另外, 刷新 UIWebview 的方式如下, 有 两种方式 来刷新页面:</li>
</ul>
<p>/**</p>
<ul>
<li><p>刷新页面.<br>*/</p>
<ul>
<li>(void)onRefreshWebView<br>{<br>// 方式1: 不使用缓存请求数据<br>//[self loadDataNoUsingCache];</li>
</ul>
<p>// 方式2: 清除 NSCache 缓存, 再请求数据<br>[self clearAllCache];<br>[self loadDataUsingCache];<br>}<br>这种刷新方式, 会重新加载数据.<br>但是不适合多层级的 HTML 页面, 比如你的 HTML 页面有很多层, 想刷新当前页面, 可以使用下面的方式:</p>
</li>
</ul>
<p>// 重新加载当前页面<br>[self.webView reload];</p>
<p>下面是大致的逻辑</p>
<p>1 判断请求中的request 是不是使用get方法，据资料显示一些本地请求的协议也会进到这个方法里面来，所以在第一部，要把不相关的请求排除掉。</p>
<p>2 判断缓存文件夹里面是否存在该文件，如果存在，继续判断文件是否过期，如果过期，则删除。如果文件没有过期，则提取文件，然后组成NSCacheURLResponse返回到方法当中。</p>
<p>3在有网络的情况下，如果文件夹中不存在该文件，则利用NSConnection这个类发网络请求，再把返回的data和response 数据本地化存储起来，然后组成NSCacheURLResponse返回到方法当中。</p>
<p>4其中BaseTools和其他没有在本.m文件中定义的类为常用的工具类，这里不一一展开了。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/15/UIView设置背景图/" title="最佳UIView添加背景图（高性能）" itemprop="url">最佳UIView添加背景图（高性能）</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="史成" target="_blank" itemprop="author">史成</a>
		
  <p class="article-time">
    <time datetime="2017-07-14T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-07-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>有些时候为了显示效果需要给UIView添加背景图，不嫌麻烦确实有好多种方法，但是必须考虑性能方面的，能剩一点是一点啊。</p>
<p>一、加一个UIImageview在UIView上 （最笨最笨的方法）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">UIImageView *imageView = [[UIImageView alloc]initWithFrame:self.view.bounds];  </div><div class="line">    imageView.image = [UIImage imageNamed:@&quot;home&quot;];  </div><div class="line">    [self.view addSubview:imageView];</div></pre></td></tr></table></figure>
<p>二、通过图片来生成UIColor来设置UIView的背景色。注意是根据图片来生成color（不推荐）</p>
<ol>
<li>imageName方式：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">self.view.backgroundColor =[UIColor colorWithPatternImage:[UIImage imageNamed:@&quot;home&quot;]];</div></pre></td></tr></table></figure>
<ol>
<li>contentOfFile方式</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSString *path = [[NSBundle mainBundle]pathForResource:@&quot;name&quot; ofType:@&quot;png&quot;];  </div><div class="line">    self.view.backgroundColor =[UIColor colorWithPatternImage:[UIImage imageWithContentsOfFile:path]];</div></pre></td></tr></table></figure>
<p>以上两种方式都会在生成color的时候消耗大量的内存（原始图片的N倍，这个N可能会达到几千的程度，而且如果原始图片大小不够，就会按照原始大小一个一个U画过去，是不会自动拉伸的。1和2的区别：1中的color不会随着View的释放而释放，而是一直存在于内存中。（再次根据这个图片生成Color的时候，不会再次去申请内存）。而2中的color会随着View的释放而释放。</p>
<p>三、quarCore方式（推荐）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">UIImage *image = [UIImage imageNamed:@&quot;home&quot;];  </div><div class="line">    //推荐这样创建image对象：UIImage *image = [UIImage imageWithContentsOfFile:path];  </div><div class="line">    self.view.layer.contents = (id)image.CGImage;  </div><div class="line">    //背景透明加上这一句  </div><div class="line">    self.view.layer.backgroundColor = [UIColor clearColor].CGColor;</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/14/页面空白状态的设计/" title="app空表页面优化" itemprop="url">app空表页面优化</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="史成" target="_blank" itemprop="author">史成</a>
		
  <p class="article-time">
    <time datetime="2017-07-13T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-07-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>##空白页面、用户体验优原理</p>
<p>###空白页面是和网络状态息息相关并且同等重要的一块儿，往往也是很多app遗漏的一大块儿</p>
<p>空白状态只的是应用程式在“没有资料”、“空列表”、或“错误”所呈现的一个画面，空白状态会透过一些图示或文字告诉使用者怎么回事，最后引导使用者操作相关的功能。良好的应用程式会花很多心思空白状态上，引导使用者添加内容到应用上，增强使用者的黏着度。</p>
<p>相关文章链接：<br>引导页：《腾讯实战干货！怎么让引导页不再是无用小透明？》<a href="http://www.uisdc.com/useful-guide-page-design" target="_blank" rel="external">—-&gt;</a><br>弹框设计：《超全面！腾讯设计师做了100个弹框后总结的设计经验》<a href="http://www.uisdc.com/tencent-100-popup-box" target="_blank" rel="external">—-&gt;</a><br>空状态设计：《超多干货！什么样的空状态设计才能留住用户？》<a href="http://www.uisdc.com/empty-states-deserve-more-design" target="_blank" rel="external">—-&gt;</a></p>
<p>####空白状态有几种形态</p>
<ol>
<li>第一次使用</li>
</ol>
<p>使用者第一次打开你的应用程式，他们对你的应用还不是很瞭解，你应该好好利用空白状态来向他们说明你的功能，透过空白状态引导他们操作。</p>
<ol>
<li>使用者主动清除内容</li>
</ol>
<p>空白状态可能是由使用者所触发，例如使用者删除了内容，或者使用者触发了一些事件（全部标示为）。这个情况很有可能是值得贺喜的，不妨在此时展现你的幽默或者鼓励使用者。</p>
<ol>
<li>发生错误</li>
</ol>
<p>空白状态发生的原因有可能是发生了错误，比较常见的状态是“404找不到网页”、“网路连线中断”，请在这个状态下让使用者能够重试并引导使用者解决所发生的问题。</p>
<p>####空白状态任务<br>空白状态扮演者很重要的角色，几乎所有的内容应用都会走过这条路。其主要任务是“引导使用者顺利建立内容”，空白状态必须使用简明扼要的文字、清楚的标示告诉使用者这里会将会放置什么样的内容，并且简单告诉使用者建立内容的好处，引导、带领使用者建立内容。花点心思在这里，不要让空白状态成为使用者最后看到的状态！</p>
<blockquote>
<p>告诉使用者什么样的资料会出现在这里<br>引导使用者如何建立内容<br>告诉使用者为什么要建立资料</p>
</blockquote>
<p>####空白状态设计常常是<br>好的空状态设计会让使用者感受到，它本来就应该在那里，它不会挡住使用者的道路，而是引导使用者走在思维的路径上。</p>
<blockquote>
<p>让使用者感受不到它的存在<br>像是导航的方式完成任务而非教导<br>一目瞭然</p>
</blockquote>
<p>####空白状态的设计要点是</p>
<blockquote>
<p>告诉使用者如何输入资料、包含手势操作、和内容功能<br>最好在一个画面就可以呈现完毕，别把满版的说明书搬出来<br>如果需要多个步骤才能完成，请清楚的告诉使用者有多少步骤<br>必须让使用者一眼就看出要做什么<br>如果空的状态是好的，可以在清空状态时显示些有趣的图案<br>空白状态只会出现在空白的情况，请确保从引导中学习到的与非空白的情况下操作经验一致<br>如果新增内容的方式较为复杂，请使用影片或动画取代文字</p>
</blockquote>
<p>以下是几种常见设计案例</p>
<ol>
<li>使用系统推荐项</li>
</ol>
<p>既然空状态如此影响用户体验，那么最直观的想法当然是往空白界面填充一些东西，这样就不是空状态了。对于一些信息浏览页面来说，这的确是一个非常简便易行的方法。既然没有东西，那么我们系统就推荐一些东西给用户，这样界面就不会空荡荡啦。所以说，这种方法非常适合在应用启动时（并且是初次启动时）使用，而且，这种方法其实现在已经非常流行了。</p>
<p>比如说：在除此打开Anyview时，系统在展示“书架”这个页面，按理说，我没有进行任何操作，这个界面当然是空的啦。不过既然空状态如此不堪，那么Anyview就自动塞进去了一堆书。这样就完美地解决了问题。不过塞什么东西进去是有讲究的，通常是一些热门的东西。至于Anyview，他会先让我回答一些问题，在获取了一些基本数据之后，它才给我推荐了这些书籍，这样推荐的精准度也会高些。现在的阅读软件基本都沿用了这种方法。</p>
<p>当然，在其他的浏览页面，比如说lofter、花瓣等图片社区，也会采用这种方式。所以，现在对于此类应用，空白界面越来越少见了。</p>
<ol>
<li>使用操作指引</li>
</ol>
<p>在有些场景下，的确是可以通过系统推荐项来达到无中生有的目的。比如说：在我的关注人的状态中，可以插入系统推荐的状态来以假乱真。但是，这种方法确实不是万能的。举个例子，假设有一款图片分享类的应用，然后有个页面是“我的图片”，如果在我从来没有发布过图片的时候，这个页面理所应当就是空的。并且在这个时候，第一种方法显然是不可行的。当然，空荡荡的界面有不好，所以此时可以通过操作指引来引导用户产生内容。</p>
<p>这时候的逻辑是这样子的：界面展示用户产生的内容→用户没有产生内容→我们来指引用户产生内容。这样子即消灭了空页面，又可以让用户产生内容，一举两得。而且，这种方法还可以解决一种问题：用户不知道生产内容的入口在哪。所以，这么一看，这种方法简直是一石三鸟。</p>
<p>操作指引有两种方式，一种是通过浮层来引导操作入口，另一种是创建快捷入口。说文字比较苍白，直接看下面的配图吧。</p>
<ol>
<li>使用缓存</li>
</ol>
<p>把之前的的内容存储下来，在展示页面的时候先展示缓存的内容，再加载新内容，这样就非常简单地把空状态消灭了。现在大多数的资讯浏览类的页面都会采用这种方式，比如说朋友圈，网易新闻等等，以至于大家都习以为常了，反而忘了其实这也是消灭空状态的一种方式。</p>
<ol>
<li><p>情感化表达<br>当空白界面是用户操作的结果时，我曾说过这里其实没有太多的方法，我们只能老老实实地跟用户说这里就是空白状态。只是，在这样一个追求用户体验的年代，大家也开始把这个提醒表达得更加生动形象一些。在这里会加入一些情感化的表达，而不仅仅只是冷冰冰的文字，比如加上俏皮的图像，或者把文案写得更加戏剧化一些。这些配图在让用户明白当前的状态的同时，往往也能引发用户会心一笑，从而弥补空白页面带来的失落感甚至可以带给用户一些正面的情感</p>
</li>
<li><p>提供新任务</p>
</li>
</ol>
<p>前面的四种方法其实说到底，都是在弥补当前任务失败造成的失落感。也就是说，我们的落脚点仍旧在当前的任务中。不过，当当前的任务完全不可行的时候，这时候就需要考虑新的方法了。比如，提供给用户新的任务，让他暂时忘记当前的任务，自然而然就不会有挫败感了。</p>
<p>举个例子吧，当在断网的情况下用户使用chrome浏览器浏览网页的时候，界面会显示一个小游戏。这是一个通过空格键操纵小恐龙躲避障碍的游戏，游戏虽小，但是趣味性十足。在浏览网页失败的时候，提供这么一个小游戏去分散用户的注意力。不得不说，这确实是一个非常好的维度。</p>
<p>再举个例子，当访问腾讯系的网页访问失败的时候，网页除了显示404状态之外，还会显示一个寻人启事。把错误界面和公益结合在一起，不得不说，创意十足。既解决了空状态的问题，又做了好事，一举两得。而且用户可能可能被这个公益的举动吸引了，然后就成功地转移了这是一个404页面的事实。</p>
<p>这些都是交互方面的知识了，开发后备使用。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/13/字体设置/" title="彻底了解iOS字体相关知识" itemprop="url">彻底了解iOS字体相关知识</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="史成" target="_blank" itemprop="author">史成</a>
		
  <p class="article-time">
    <time datetime="2017-07-12T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-07-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>##彻底了解iOS字体相关知识</p>
<ol>
<li>iOS原生字体展示</li>
</ol>
<p>在label中选择字体的font，并把font由system改成custom后，就能在family中看到72种特殊字体。这些里面就有很炫的字体，但是全部是只针对英文数字，对中文无效。写了一个程序把所有的原生样式遍历出来展示可以达到如下效果。可以清楚地看到每个字体对应的样式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">label.font = [UIFont systemFontOfSize:14]; //默认字体</div><div class="line"></div><div class="line">UIFont *font = [UIFont fontWithName:@&quot;Georgia&quot; size:14]; //其他字体</div></pre></td></tr></table></figure>
<p>###获取family名称<br>在UIFont类中有这些关于家族名和字体名的开放API，通过这些可以清晰的写个遍历打印，查看所有的familyName和其中包含的fontName</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">int i = 0;</div><div class="line">for(NSString *fontfamilyname in [UIFont familyNames])</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;family:&apos;%@&apos;&quot;,fontfamilyname);</div><div class="line">    for(NSString *fontName in [UIFont fontNamesForFamilyName:fontfamilyname])</div><div class="line">    &#123;</div><div class="line">        NSLog(@&quot;\tfont:&apos;%@&apos;&quot;,fontName);</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;-------------%d&quot;,i++);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>从外界引入字体<br>字体只要是ttf格式的，一般iOS程序都支持内嵌,用法很简单<blockquote>
<p>将ttf文件拖入项目中<br>.修改plist文件，加入Fonts provided by application 配置，后面填上拖进来的项目名<br>就可以在图形化界面看到新的字体选择了<br>如果不想从IB界面找，建议使用一下上面的遍历打印，可以用循环打印数量来最直接的看是否导入成功，并找到自己需要的内容。</p>
</blockquote>
</li>
</ol>
<p>###动态字体<br>动态字体-Dynamic Type源于iOS7引入的一个文本渲染框架TextKit。主要的作用就是可以系统自设大小。当下的苹果已经做了越来越多的人性化的处理，甚至连盲人模式都有。对于字体的展示也是考虑到了各人的喜好，有的人喜欢看大字，有的人喜欢看小字。在动态字体出来之前，有的应用也考虑到了此用户体验，比如网易新闻以前就有能够在应用中设置偏好的字体大小功能。苹果也整合到了整个手机中，动态字体的思想就是：在setting中设置字体大小，不单单系统的字体会变，连应用程序中的字体大小也会随之改变。前提是你应用程序中的字体的代码写的符合要求。</p>
<p>前面的文章大部分说的都是要在字体中选custom，这时要考虑动态字体就有选 Text Styles中的选项了。</p>
<p>UIFontTextStyleHeadline<br>UIFontTextStyleBody<br>UIFontTextStyleSubheadline<br>UIFontTextStyleFootnote<br>UIFontTextStyleCaption1<br>UIFontTextStyleCaption2</p>
<p>这些样式顾名思义，就不每个都列出显示效果了。标题，子标题，正文等等都是一些比较朴素。 我感觉这也就相当于word中的“样式”，把自己的每个章节的标题子标题选中设置成标题一或者标题二 然后就能用word的自动生成目录功能，并且一改某个样式里详细设置，每个标题子标题的格式也都会随之改变。 这里就是如果你在代码中把字体用这些样式，那你在手机setting里设置大小之后应用字体会有所反应。</p>
<p>设置字体的位置是： 设置-》显示与亮度-》文字大小</p>
<p>设置动态字体的代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UIFont *font = [UIFont preferredFontForTextStyle:UIFontTextStyleSubheadline];</div></pre></td></tr></table></figure>
<p>###字体描述符<br>字体描述符-UIFontDescriptor  也是TextKit的核心之一，大致意思就是：字体描述符可以把一个你不知道详情的font样式临时存起来做修改或赋值给别人使用。在使用了上面的动态字体之后，可能你只知道现在的text-Style但是详细的familyName，fontName都不知道是什么，这种情况下如果想修改字体的样式为斜体或粗体就只能使用这种方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// ------取出当前正文的字体样式</div><div class="line">UIFontDescriptor *bodyFontDesciptor = [UIFontDescriptor preferredFontDescriptorWithTextStyle:UIFontTextStyleBody];</div><div class="line">// ------把样式改为斜体</div><div class="line">UIFontDescriptor *italicFontDescriptor = [bodyFontDesciptor fontDescriptorWithSymbolicTraits:UIFontDescriptorTraitItalic];</div><div class="line">// ------赋值给另一个label。</div><div class="line">self.titleLabel.font = [UIFont fontWithDescriptor:italicFontDescriptor size:0.0];</div></pre></td></tr></table></figure>
<p>关于样式一共有四种可选：</p>
<p>UIFontDescriptorTraitItalic</p>
<p>UIFontDescriptorTraitExpanded</p>
<p>UIFontDescriptorTraitCondensed</p>
<p>UIFontDescriptorTraitBold</p>
<p>字体描述符还有一个API是通过详细属性字典设置一个label的样式，写法如下 :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">UIFontDescriptor *attributeFontDescriptor = [UIFontDescriptor fontDescriptorWithFontAttributes:</div><div class="line">    @&#123;UIFontDescriptorFamilyAttribute: @&quot;Avenir Next Condensed&quot;,</div><div class="line">      UIFontDescriptorNameAttribute:@&quot;AvenirNextCondensed-Italic&quot;,</div><div class="line">      UIFontDescriptorSizeAttribute: @40.0,</div><div class="line">      UIFontDescriptorMatrixAttribute:[NSValue valueWithCGAffineTransform:CGAffineTransformMakeRotation(M_1_PI*1.5)</div><div class="line">      ]&#125;];</div><div class="line">label.font = [UIFont fontWithDescriptor:attributeFontDescriptor size:0.0];</div></pre></td></tr></table></figure>
<p>这上面分别设置了家族名，字体名，尺寸，形变，最后的size填0.0就可以，如果填了一个值，那这个值会把上面字典中的尺寸覆盖，感觉一般情况下应该不会有人这么蛋疼用这种方法建样式，这个Attribute按command点进去还有很多，大多都是平时用不到的，有兴趣的可以一个一个钻研，好像一共有十几个。</p>
<p>###扩展字体样式<br>上面说了原生全部不支持中文，但是我们用中文的人还是比较多，中文字体现在在网上搜索结果很多，但是大部分都不是想要的结果，要不就是不会让你那么简单下载的。我整理了一个常用的字体样式包，里面大致包括：</p>
<p>华文行楷，华文琥珀，华文新魏，隶书 等等这些熟悉的名字</p>
<p>纯净下载地址：<a href="http://share.weiyun.com/41030490c3059ae729eb8509c4b4761a" target="_blank" rel="external">http://share.weiyun.com/41030490c3059ae729eb8509c4b4761a</a></p>
<p>除了这些常用样式，还有一些非常规的字体样式，当然好的字体遇到时我会积累，并整理在下面，不要求多，只要求精。</p>
<p>纯净下载地址：<a href="http://share.weiyun.com/4000e63cf4ba083216815bc763cc3fad" target="_blank" rel="external">http://share.weiyun.com/4000e63cf4ba083216815bc763cc3fad</a></p>
<p><a href="http://www.cnblogs.com/dsxniubility/p/4699352.html" target="_blank" rel="external">原文网址</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/12/实际网络连接情况监测/" title="没有网络时候app优化设计" itemprop="url">没有网络时候app优化设计</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="史成" target="_blank" itemprop="author">史成</a>
		
  <p class="article-time">
    <time datetime="2017-07-11T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-07-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>##没有网络时候app优化设计</p>
<p>用户体验很重要，网络连接关乎着界面数据展示，当网络不好时或断开连接及时的给用户提示，这个是每个app都必须解决的实际问题，避免不了，所以如何很好的实现这个还是值得查看一下。</p>
<p>常用的AFNetworking有自己封装好的网络监测接口，另外Reachablity就是为了干这个事的。这基本上可以满足表面上的要求。</p>
<p>事实上这个并不能帮助我们检测真正的网络连接状态，它们能检测的只是本地连接状态；这种情况包括但不限于如下场景：</p>
<blockquote>
<p>现在很流行的公用wifi，需要网页鉴权，鉴权之前无法上网，但本地连接已经建立；<br>存在了本地网络连接，但信号很差，实际无法连接到服务器；<br>iOS连接的路由设备本身没有连接外网。</p>
</blockquote>
<p>reachability 也明确表示了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;Reachability cannot tell your application if you can connect to a particular host, only that an interface is available that might allow a connection, and whether that interface is the WWAN.&quot;</div></pre></td></tr></table></figure>
<p>而苹果的SCNetworkReachability API则告诉了我们更多： “Reachability does not guarantee that the data packet will actually be received by the host. “</p>
<p>Reachability相关的框架在底层都是通过SCNetworkReachability来实现网络检测的，所以无法检测实际网络连接情况。</p>
<p><strong>鉴于此，原文作者发明了RealReachability</strong></p>
<p>这个框架开发的初衷来源于项目实际需求，离线模式对网络连接状态的要求比较苛刻，且实际场景经常会遇到“伪连接”的情况，Reachability面对此场景力不从心。多方研究后引入了ping能力（此方案流量开销最小，也最简单），实现了简单的实际网络连接监测</p>
<p>###继承和使用介绍</p>
<ol>
<li>集成</li>
</ol>
<p>最简便的集成方法当属pod: pod ‘RealReachability’。</p>
<p>手动集成：将RealReachability文件夹加入到工程即可。</p>
<p>依赖：Xcode5.0+，支持ARC, iOS6+.项目需要引入SystemConfiguration.framework. </p>
<ol>
<li>使用</li>
</ol>
<p>其接口的设计和调用方法和Reachability非常相似，大家可以无缝上手，非常方便。 开启网络监听：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[GLobalRealReachability startNotifier];</div><div class="line">    [[NSNotificationCenter defaultCenter] addObserver:self</div><div class="line">                                             selector:@selector(networkChanged:)</div><div class="line">                                                 name:kRealReachabilityChangedNotification</div><div class="line">                                               object:nil];</div></pre></td></tr></table></figure>
<p>回调代码示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)networkChanged:(NSNotification *)notification</div><div class="line">&#123;</div><div class="line">    RealReachability *reachability = (RealReachability *)notification.object;</div><div class="line">    ReachabilityStatus status = [reachability currentReachabilityStatus];</div><div class="line">    NSLog(@&quot;currentStatus:%@&quot;,@(status));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>触发实时网络状态查询代码示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[GLobalRealReachability reachabilityWithBlock:^(ReachabilityStatus status) &#123;</div><div class="line">        switch (status)</div><div class="line">        &#123;</div><div class="line">            case NotReachable:</div><div class="line">            &#123;</div><div class="line">            //  case NotReachable handler</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">             </div><div class="line">            case ReachableViaWiFi:</div><div class="line">            &#123;</div><div class="line">            //  case ReachableViaWiFi handler</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">             </div><div class="line">            case ReachableViaWWAN:</div><div class="line">            &#123;</div><div class="line">            //  case ReachableViaWWAN handler</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">            default:</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<p>查询当前实际网络连接状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ReachabilityStatus status = [reachability currentReachabilityStatus];</div></pre></td></tr></table></figure>
<p>实现原理：<br><img src="http://ooyerqo96.bkt.clouddn.com/1456212358863328.png" alt="实现原理"></p>
<p>realReachability架构概要图RealReachability主要包含3大模块：connection、ping、FSM； 其中Ping模块通过对同样是苹果提供的ping样例代码进行了封装，connection模块实现了基于SCNetworkReachability的本地状态检测，FSM模块是有限状态机。通过FSM的状态管理控制connection模块和Ping模块协同工作，并通过可配置的定时策略等业务逻辑优化，最终得到了我们的实现。</p>
<p><strong>向大牛学习，努力成为大牛！</strong></p>
<p><a href="http://www.cocoachina.com/ios/20160224/15407.html" target="_blank" rel="external">原文网址</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  

  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://www.jianshu.com" target="_blank" title="简书">简书</a>
            
          </li>
        
          <li>
            
            	<a href="www://guthub.com" target="_blank" title="GitHub">GitHub</a>
            
          </li>
        
          <li>
            
            	<a href="www://cocoachina.com" target="_blank" title="cocoachina">cocoachina</a>
            
          </li>
        
          <li>
            
            	<a href="http://mybigorange.github.io" target="_blank" title="Ambrose&#39;s Blog">Ambrose&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="www.baidu.com" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Dean Ambrose Page in Github. <br/>
			Welcome to my bog.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/5767005756" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="史成">史成</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
